<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SNAC ê´€ë¦¬ì</title>
  <link rel="stylesheet" href="../styles.css?v=90">
</head>
<body class="input-page">
  <!-- ì½”ë“œ ì…ë ¥ í™”ë©´ -->
  <div id="codeScreen">
    <div class="login-container">
      <div class="login-box">
      <h1>S N A C</h1>
      <form id="codeForm" onsubmit="checkCode(event)">
        <div class="form-group">
          <label for="accessCode">ì ‘ê·¼ ì½”ë“œ</label>
          <input type="password" id="accessCode" name="accessCode" required autofocus placeholder="ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        <button type="submit" class="btn btn-primary">í™•ì¸</button>
        <div id="errorMessage" style="color: #ff4444; margin-top: 15px; text-align: center; display: none;">
          ì˜ëª»ëœ ì½”ë“œì…ë‹ˆë‹¤.
        </div>
      </form>
      </div>
    </div>
  </div>

  <!-- ì‹¤ì œ ì…ë ¥ í˜ì´ì§€ ë‚´ìš© -->
  <div id="inputScreen" class="container" style="display: none;">
    <h1>S N A C</h1>
    
    <div class="nav">
      <a href="javascript:void(0)" onclick="handleViewClick(event); return false;">ì¡°íšŒ</a>
    </div>

    <div class="options-panel">
      <button class="btn btn-secondary" onclick="openOptions()">ì˜µì…˜ ì„¤ì •</button>
      <button class="btn btn-info" onclick="openAccountModal()">ê³„ì • ìƒì„±</button>
      <button class="btn btn-warning" onclick="openAccountManageModal()">ê³„ì • ê´€ë¦¬</button>
      <button class="btn btn-danger" onclick="deleteAllRows()">ì‹œíŠ¸ ì „ì²´ ì‚­ì œ</button>
    </div>

    <!-- ì¡°íšŒ ê³„ì • ì„¤ì • ëª¨ë‹¬ -->
    <div id="accountModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeAccountModal()">&times;</span>
        <h2>ê³„ì • ìƒì„±</h2>
        <form id="accountForm" onsubmit="saveAccount(event)">
          <div class="form-group">
            <label for="accountId">ì•„ì´ë””</label>
            <input type="text" id="accountId" name="accountId" required placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
          </div>
          <div class="form-group">
            <label for="accountPassword">ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="accountPassword" name="accountPassword" required placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
          </div>
          <div class="form-group">
            <label for="accountPasswordConfirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input type="password" id="accountPasswordConfirm" name="accountPasswordConfirm" required placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”">
          </div>
          <button type="submit" class="btn btn-primary">ì €ì¥</button>
        </form>
      </div>
    </div>

    <!-- ê³„ì • ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="accountManageModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeAccountManageModal()">&times;</span>
        <h2>ê³„ì • ê´€ë¦¬</h2>
        <div id="accountList" class="account-list">
          <!-- ê³„ì • ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
      </div>
    </div>

    <div class="sheet-tabs-container">
      <div class="sheet-tabs">
        <div class="sheet-tab active" data-sheet="main">ì¶•êµ¬</div>
        <div class="sheet-tab" data-sheet="mainAuto">ì¶•êµ¬(ìë™)</div>
        <div class="sheet-tab" data-sheet="sheet1">ê¸ˆì§€</div>
      </div>
    </div>
    
    <!-- ë©”ì¸ ì…ë ¥ ì‹œíŠ¸ -->
    <div id="mainSheet" class="sheet-content active">
      <h2>ì¶•êµ¬</h2>
      <div class="sheet-buttons">
        <button class="btn btn-secondary btn-large" onclick="saveAll()">ì €ì¥í•˜ê¸°</button>
        <button class="btn btn-large" onclick="addMultipleRows()">í–‰ ì¶”ê°€</button>
        <span id="lastSaveTime" class="last-save-time"></span>
      </div>
      <table id="inputTable">
      <colgroup>
        <col style="width: 3%;">  <!-- 1. ë²ˆí˜¸ (3%) -->
        <col style="width: 4.257%;">  <!-- 2. ì‹œê°„ (A ê·¸ë£¹) -->
        <col style="width: 3%;">  <!-- 3. ë¦¬ê·¸ë“±ê¸‰ (3%) -->
        <col style="width: 9%;">  <!-- 4. ë¦¬ê·¸ (9%) -->
        <col style="width: 9%;">  <!-- 5. í™ˆíŒ€ (9%) -->
        <col style="width: 9%;">  <!-- 6. ì›ì •íŒ€ (9%) -->
        <col style="width: 4.257%;">  <!-- 7. í™ˆ/ì›ì • (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 8. ìŠ¹ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 9. ì˜¤ë²„ê¸°ì¤€ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 10. ì˜¤ë²„ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 11. ìŠ¹ 75ë¶„ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 12. ì˜¤ë²„ 75ë¶„ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 13. ìŠ¹ í˜„ë°°ë‹¹ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 14. ì˜¤ë²„ í˜„ë°°ë‹¹ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 15. ìŠ¹ í•˜ë½ìˆ˜ì¹˜ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 16. ì˜¤ë²„ í•˜ë½ìˆ˜ì¹˜ (A ê·¸ë£¹) -->
        <col style="width: 7.5%;">  <!-- 17. ì˜¤ë²„ ë“±ê¸‰ (7.5%) -->
        <col style="width: 5%;">  <!-- 18. ìŠ¹ ë“±ê¸‰ (5%) -->
        <col style="width: 8%;">  <!-- 19. ê¸°ëŠ¥ (8%) -->
      </colgroup>
      <thead>
        <tr>
          <th rowspan="2">ë²ˆí˜¸</th>
          <th rowspan="2">ì‹œê°„</th>
          <th rowspan="2" id="leagueGradeHeader">ë¦¬ê·¸<br>ë“±ê¸‰</th>
          <th rowspan="2">ë¦¬ê·¸</th>
          <th rowspan="2">í™ˆíŒ€</th>
          <th rowspan="2">ì›ì •íŒ€</th>
          <th colspan="4">ê¸°ì¤€ë°°ë‹¹</th>
          <th colspan="2">75</th>
          <th colspan="2">í˜„ë°°ë‹¹</th>
          <th colspan="2">í•˜ë½ìˆ˜ì¹˜</th>
          <th colspan="2">ë“±ê¸‰</th>
          <th rowspan="2">ê¸°ëŠ¥</th>
        </tr>
        <tr>
          <th>í™ˆ/ì›ì •</th>
          <th>ìŠ¹</th>
          <th>ì˜¤ë²„ê¸°ì¤€</th>
          <th>ì˜¤ë²„</th>
          <th>ìŠ¹</th>
          <th>ì˜¤ë²„</th>
          <th>ìŠ¹</th>
          <th>ì˜¤ë²„</th>
          <th>ìŠ¹</th>
          <th>ì˜¤ë²„</th>
          <th>ì˜¤ë²„</th>
          <th>ìŠ¹</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- í–‰ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </tbody>
    </table>
    </div>
    
    <!-- ì¶•êµ¬(ìë™) ì…ë ¥ ì‹œíŠ¸ -->
    <div id="mainAutoSheet" class="sheet-content">
      <h2>ì¶•êµ¬(ìë™)</h2>
      <div class="sheet-buttons">
        <button class="btn btn-secondary btn-large" onclick="saveAllAuto()">ì €ì¥í•˜ê¸°</button>
        <button class="btn btn-large" onclick="addMultipleRowsAuto()">í–‰ ì¶”ê°€</button>
        <span id="lastSaveTimeAuto" class="last-save-time"></span>
      </div>
      <table id="inputTableAuto">
      <colgroup>
        <col style="width: 3%;">  <!-- 1. ë²ˆí˜¸ (3%) -->
        <col style="width: 4.257%;">  <!-- 2. ì‹œê°„ (A ê·¸ë£¹) -->
        <col style="width: 3%;">  <!-- 3. ë¦¬ê·¸ë“±ê¸‰ (3%) -->
        <col style="width: 9%;">  <!-- 4. ë¦¬ê·¸ (9%) -->
        <col style="width: 9%;">  <!-- 5. í™ˆíŒ€ (9%) -->
        <col style="width: 9%;">  <!-- 6. ì›ì •íŒ€ (9%) -->
        <col style="width: 4.257%;">  <!-- 7. í™ˆ/ì›ì • (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 8. ìŠ¹ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 9. ì˜¤ë²„ê¸°ì¤€ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 10. ì˜¤ë²„ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 11. ìŠ¹ 75ë¶„ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 12. ì˜¤ë²„ 75ë¶„ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 13. ìŠ¹ í˜„ë°°ë‹¹ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 14. ì˜¤ë²„ í˜„ë°°ë‹¹ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 15. ìŠ¹ í•˜ë½ìˆ˜ì¹˜ (A ê·¸ë£¹) -->
        <col style="width: 4.257%;">  <!-- 16. ì˜¤ë²„ í•˜ë½ìˆ˜ì¹˜ (A ê·¸ë£¹) -->
        <col style="width: 7.5%;">  <!-- 17. ì˜¤ë²„ ë“±ê¸‰ (7.5%) -->
        <col style="width: 5%;">  <!-- 18. ìŠ¹ ë“±ê¸‰ (5%) -->
        <col style="width: 8%;">  <!-- 19. ê¸°ëŠ¥ (8%) -->
      </colgroup>
      <thead>
        <tr>
          <th rowspan="2">ë²ˆí˜¸</th>
          <th rowspan="2">ì‹œê°„</th>
          <th rowspan="2" id="leagueGradeHeaderAuto">ë¦¬ê·¸<br>ë“±ê¸‰</th>
          <th rowspan="2">ë¦¬ê·¸</th>
          <th rowspan="2">í™ˆíŒ€</th>
          <th rowspan="2">ì›ì •íŒ€</th>
          <th colspan="4">ê¸°ì¤€ë°°ë‹¹</th>
          <th colspan="2">75</th>
          <th colspan="2">í˜„ë°°ë‹¹</th>
          <th colspan="2">í•˜ë½ìˆ˜ì¹˜</th>
          <th colspan="2">ë“±ê¸‰</th>
          <th rowspan="2">ê¸°ëŠ¥</th>
        </tr>
        <tr>
          <th>í™ˆ/ì›ì •</th>
          <th>ìŠ¹</th>
          <th>ì˜¤ë²„ê¸°ì¤€</th>
          <th>ì˜¤ë²„</th>
          <th>ìŠ¹</th>
          <th>ì˜¤ë²„</th>
          <th>ìŠ¹</th>
          <th>ì˜¤ë²„</th>
          <th>ìŠ¹</th>
          <th>ì˜¤ë²„</th>
          <th>ì˜¤ë²„</th>
          <th>ìŠ¹</th>
        </tr>
      </thead>
      <tbody id="tableBodyAuto">
        <!-- í–‰ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </tbody>
    </table>
    </div>
    
    <!-- ì‹œíŠ¸1 (ì‹œê°„/ë¦¬ê·¸/í™ˆíŒ€/ì›ì •íŒ€/ë‚´ìš©) -->
    <div id="sheet1" class="sheet-content">
      <h2>ê¸ˆì§€</h2>
      <div class="sheet-buttons">
        <button class="btn btn-secondary btn-large" onclick="saveSheet1()">ì €ì¥í•˜ê¸°</button>
        <button class="btn btn-large" onclick="addSheet1Row()">í–‰ ì¶”ê°€</button>
      </div>
      <table class="new-sheet-table">
        <thead>
          <tr>
            <th>ë²ˆí˜¸</th>
            <th>ì‹œê°„</th>
            <th>ë¦¬ê·¸</th>
            <th>í™ˆíŒ€</th>
            <th>ì›ì •íŒ€</th>
            <th>ë‚´ìš©</th>
            <th>ê¸°ëŠ¥</th>
          </tr>
        </thead>
        <tbody id="sheet1_tbody">
          <!-- í–‰ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const ACCESS_CODE = 'bbjjbb';

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸
    window.addEventListener('DOMContentLoaded', () => {
      const isAuthenticated = sessionStorage.getItem('bjb_authenticated');
      if (isAuthenticated === 'true') {
        showInputScreen();
      } else {
        showCodeScreen();
      }
    });

    // ì½”ë“œ í™•ì¸ í•¨ìˆ˜
    function checkCode(event) {
      event.preventDefault();
      const codeInput = document.getElementById('accessCode');
      const errorMessage = document.getElementById('errorMessage');
      
      if (codeInput.value === ACCESS_CODE) {
        sessionStorage.setItem('bjb_authenticated', 'true');
        showInputScreen();
      } else {
        errorMessage.style.display = 'block';
        codeInput.value = '';
        codeInput.focus();
      }
    }

    // ì½”ë“œ ì…ë ¥ í™”ë©´ í‘œì‹œ
    function showCodeScreen() {
      document.getElementById('codeScreen').style.display = 'flex';
      document.getElementById('inputScreen').style.display = 'none';
    }

    // ì…ë ¥ í™”ë©´ í‘œì‹œ
    function showInputScreen() {
      document.getElementById('codeScreen').style.display = 'none';
      document.getElementById('inputScreen').style.display = 'block';
      // overflow ì œê±°
      document.body.classList.remove('code-screen-active');
      // ì…ë ¥ í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
      loadInputScripts();
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ì„¤ì • (í™•ì‹¤í•˜ê²Œ í•˜ê¸° ìœ„í•´)
      setTimeout(() => {
        setupSheetTabListeners();
      }, 100);
    }
    
    // ì‹œíŠ¸ íƒ­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • í•¨ìˆ˜
    function setupSheetTabListeners() {
      // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
      document.querySelectorAll('.sheet-tab').forEach(tab => {
        const newTab = tab.cloneNode(true);
        tab.parentNode.replaceChild(newTab, tab);
      });
      
      // ìƒˆ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      document.querySelectorAll('.sheet-tab').forEach(tab => {
        tab.addEventListener('click', function() {
          const sheetName = this.getAttribute('data-sheet');
          console.log('ğŸ“Œ íƒ­ í´ë¦­:', sheetName);
          switchSheet(sheetName);
        });
      });
    }

    // ì…ë ¥ í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ ë™ì  ë¡œë“œ
    function loadInputScripts() {
      if (!window.inputScriptsLoaded) {
        // ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë¡œë“œ
        const loadScript = (src) => {
          return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.type = 'module';
            script.src = src;
            script.onload = resolve;
            script.onerror = reject;
            document.body.appendChild(script);
          });
        };
        
        loadScript('../firebase-config.js?v=101')
          .then(() => loadScript('../app.js?v=101'))
          .then(() => loadScript('../input.js?v=101'))
          .then(() => {
            // ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
            setTimeout(() => {
              // input.jsì˜ DOMContentLoaded ì´ë²¤íŠ¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ íŠ¸ë¦¬ê±°
              const event = new Event('DOMContentLoaded');
              window.dispatchEvent(event);
              
              // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸ˆì§€ íƒ­ ë°ì´í„° ìë™ ë¶ˆëŸ¬ì˜¤ê¸° ì œê±°
              // ê¸ˆì§€ íƒ­ì€ íƒ­ ì „í™˜ ì‹œì—ë§Œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ë„ë¡ ë³€ê²½ (ê¸°ë³¸ í–‰ ì—†ì´)
              console.log('âœ… ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ - ê¸ˆì§€ íƒ­ì€ íƒ­ ì „í™˜ ì‹œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.');
            }, 200);
          })
          .catch(err => console.error('ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', err));
        
        window.inputScriptsLoaded = true;
      }
    }
    
    // ì´ˆê¸° ë¡œë“œ ì‹œ ì½”ë“œ í™”ë©´ í‘œì‹œ ì¤‘ì´ë¯€ë¡œ overflow hidden ì¶”ê°€
    document.body.classList.add('code-screen-active');
    
    // ì‹œíŠ¸ íƒ­ í´ë¦­ ì´ë²¤íŠ¸ ì„¤ì •
    setupSheetTabListeners();
    
    // ê¸ˆì§€ íƒ­ ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (ìµœìƒë‹¨ì— ì„ ì–¸)
    let cachedSheet1Data = null;
    
    // ì‹œíŠ¸ ì „í™˜ í•¨ìˆ˜
    function switchSheet(sheetName) {
      console.log('ğŸ”„ ì‹œíŠ¸ ì „í™˜:', sheetName);
      
      // ëª¨ë“  ì‹œíŠ¸ ë‚´ìš© ê°•ì œë¡œ ìˆ¨ê¸°ê¸° (ì¤‘ìš”: !importantë¡œ í™•ì‹¤íˆ ìˆ¨ê¹€)
      const allSheets = document.querySelectorAll('.sheet-content');
      allSheets.forEach(content => {
        content.style.setProperty('display', 'none', 'important');
        content.style.setProperty('visibility', 'hidden', 'important');
        content.style.setProperty('opacity', '0', 'important');
        content.classList.remove('active');
      });
      
      // íŠ¹ë³„íˆ mainSheetì™€ mainAutoSheetë¥¼ í™•ì‹¤íˆ ìˆ¨ê¸°ê¸°
      const mainSheet = document.getElementById('mainSheet');
      const mainAutoSheet = document.getElementById('mainAutoSheet');
      const sheet1 = document.getElementById('sheet1');
      
      if (mainSheet) {
        mainSheet.style.setProperty('display', 'none', 'important');
        mainSheet.style.setProperty('visibility', 'hidden', 'important');
        mainSheet.classList.remove('active');
      }
      if (mainAutoSheet) {
        mainAutoSheet.style.setProperty('display', 'none', 'important');
        mainAutoSheet.style.setProperty('visibility', 'hidden', 'important');
        mainAutoSheet.classList.remove('active');
      }
      if (sheet1) {
        sheet1.style.setProperty('display', 'none', 'important');
        sheet1.style.setProperty('visibility', 'hidden', 'important');
        sheet1.classList.remove('active');
      }
      
      // ëª¨ë“  íƒ­ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
      document.querySelectorAll('.sheet-tab').forEach(t => t.classList.remove('active'));
      
      // ì„ íƒí•œ ì‹œíŠ¸ í‘œì‹œ
      if (sheetName === 'main') {
        console.log('âœ… ì¶•êµ¬ íƒ­ í‘œì‹œ');
        if (mainSheet) {
          // mainAutoSheetë¥¼ í™•ì‹¤íˆ ìˆ¨ê¸°ê¸°
          if (mainAutoSheet) {
            mainAutoSheet.style.setProperty('display', 'none', 'important');
            mainAutoSheet.style.setProperty('visibility', 'hidden', 'important');
            mainAutoSheet.classList.remove('active');
          }
          
          // mainSheet í‘œì‹œ
          mainSheet.style.setProperty('display', 'block', 'important');
          mainSheet.style.setProperty('visibility', 'visible', 'important');
          mainSheet.style.setProperty('opacity', '1', 'important');
          mainSheet.classList.add('active');
          
          const mainTab = document.querySelector('.sheet-tab[data-sheet="main"]');
          if (mainTab) {
            mainTab.classList.add('active');
          }
          
          // í…Œì´ë¸”ì´ ë¹„ì–´ìˆìœ¼ë©´ ë°ì´í„° í™•ì¸ ë° í–‰ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
          const tableBody = document.getElementById('tableBody');
          if (tableBody) {
            const rowCount = tableBody.querySelectorAll('tr').length;
            console.log('ğŸ“Š tableBody í˜„ì¬ í–‰ ìˆ˜:', rowCount);
            
            // ì¤‘ë³µ í–‰ ì¶”ê°€ ë°©ì§€ë¥¼ ìœ„í•œ í”Œë˜ê·¸ í™•ì¸
            if (!window.mainSheetRowsAdding && rowCount === 0) {
              window.mainSheetRowsAdding = true; // í”Œë˜ê·¸ ì„¤ì •
              console.log('ğŸ“ tableBodyê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ë°ì´í„° í™•ì¸');
              // addRow í•¨ìˆ˜ê°€ ìˆìœ¼ë©´ ë¹ˆ í–‰ ì¶”ê°€
              setTimeout(() => {
                const finalRowCount = tableBody.querySelectorAll('tr').length;
                console.log('ğŸ“Š ìµœì¢… í™•ì¸ - tableBody í–‰ ìˆ˜:', finalRowCount);
                
                if (finalRowCount === 0 && typeof window.addRow === 'function') {
                  // ìµœì†Œ 30ê°œ í–‰ ì¶”ê°€ (ì¤‘ê°„ì— í–‰ ìˆ˜ í™•ì¸)
                  let addedCount = 0;
                  for (let i = 1; i <= 30; i++) {
                    const currentCount = tableBody.querySelectorAll('tr').length;
                    if (currentCount >= 30) {
                      console.log('âœ… ì´ë¯¸ 30ê°œ í–‰ì´ ìˆìŠµë‹ˆë‹¤. ì¶”ê°€ ì¤‘ë‹¨');
                      break;
                    }
                    window.addRow(i);
                    addedCount++;
                  }
                  console.log('âœ…', addedCount, 'ê°œ í–‰ ì¶”ê°€ ì™„ë£Œ (ì¶•êµ¬ íƒ­)');
                } else if (finalRowCount > 0) {
                  console.log('âœ… ì´ë¯¸ í–‰ì´ ìˆìŠµë‹ˆë‹¤:', finalRowCount, 'í–‰');
                }
                // í”Œë˜ê·¸ í•´ì œ
                window.mainSheetRowsAdding = false;
              }, 300);
            } else if (rowCount > 0) {
              console.log('âœ… ì´ë¯¸ í–‰ì´ ìˆìŠµë‹ˆë‹¤:', rowCount, 'í–‰');
            }
          }
          
          // ì‹œíŠ¸ê°€ ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤ ì¡°ì •
          setTimeout(() => {
            if (mainSheet) {
              mainSheet.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }, 100);
        }
      } else if (sheetName === 'mainAuto') {
        console.log('âœ… ì¶•êµ¬(ìë™) íƒ­ í‘œì‹œ');
        const mainAutoSheet = document.getElementById('mainAutoSheet');
        if (!mainAutoSheet) {
          console.error('âŒ mainAutoSheetë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
          return;
        }
        
        // mainSheetë¥¼ í™•ì‹¤íˆ ìˆ¨ê¸°ê¸°
        if (mainSheet) {
          mainSheet.style.setProperty('display', 'none', 'important');
          mainSheet.style.setProperty('visibility', 'hidden', 'important');
          mainSheet.classList.remove('active');
        }
        
        console.log('âœ… mainAutoSheet ì°¾ìŒ, í‘œì‹œ ì‹œì‘');
        
        // ê°•ì œë¡œ í‘œì‹œ (ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë¡œ ìš°ì„ ìˆœìœ„ ìµœëŒ€í™”)
        mainAutoSheet.style.setProperty('display', 'block', 'important');
        mainAutoSheet.style.setProperty('visibility', 'visible', 'important');
        mainAutoSheet.style.setProperty('opacity', '1', 'important');
        mainAutoSheet.style.setProperty('position', 'relative', 'important');
        mainAutoSheet.style.setProperty('z-index', '1', 'important');
        mainAutoSheet.classList.add('active');
        
        console.log('âœ… ìŠ¤íƒ€ì¼ ì ìš© ì™„ë£Œ, display:', mainAutoSheet.style.display);
        
        // í…Œì´ë¸”ì´ ë¹„ì–´ìˆìœ¼ë©´ ë°ì´í„° ë¡œë“œ ë˜ëŠ” ë¹ˆ í–‰ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
        const tableBodyAuto = document.getElementById('tableBodyAuto');
        if (tableBodyAuto) {
          const rowCount = tableBodyAuto.querySelectorAll('tr').length;
          console.log('ğŸ“Š tableBodyAuto í˜„ì¬ í–‰ ìˆ˜:', rowCount);
          
          // ì¤‘ë³µ í–‰ ì¶”ê°€ ë°©ì§€ë¥¼ ìœ„í•œ í”Œë˜ê·¸ í™•ì¸
          if (!window.autoSheetRowsAdding && rowCount === 0) {
            window.autoSheetRowsAdding = true; // í”Œë˜ê·¸ ì„¤ì •
            console.log('ğŸ“ tableBodyAutoê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ë°ì´í„° ë¡œë“œ ë˜ëŠ” í–‰ ì¶”ê°€ ì‹œë„');
            
            // ë¨¼ì € Firebaseì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œë„
            setTimeout(async () => {
              try {
                // window.loadInputSheetDataê°€ ìˆìœ¼ë©´ ì‚¬ìš©
                if (typeof window.loadInputSheetData === 'function') {
                  const autoData = await window.loadInputSheetData();
                  if (autoData && Array.isArray(autoData) && autoData.length > 0) {
                    console.log('âœ… Firebaseì—ì„œ ì¶•êµ¬(ìë™) ë°ì´í„° ë¡œë“œ:', autoData.length, 'í–‰');
                    // loadDataFromArrayë¥¼ tableBodyAutoì— ëŒ€í•´ í˜¸ì¶œ
                    if (typeof window.loadDataFromArray === 'function') {
                      // tableBodyAutoë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •ëœ í•¨ìˆ˜ í˜¸ì¶œ í•„ìš”
                      // ì¼ë‹¨ ë¹ˆ í–‰ ì¶”ê°€ë¡œ ëŒ€ì²´
                    }
                  }
                }
              } catch (e) {
                console.warn('Firebase ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
              }
              
              // ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ë¹ˆ í–‰ ì¶”ê°€ (ë‹¤ì‹œ í™•ì¸)
              const finalRowCount = tableBodyAuto.querySelectorAll('tr').length;
              console.log('ğŸ“Š ìµœì¢… í™•ì¸ - tableBodyAuto í–‰ ìˆ˜:', finalRowCount);
              
              // ì¤‘ë³µ ë°©ì§€: ì´ë¯¸ 30ê°œ ì´ìƒì´ë©´ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
              if (finalRowCount === 0) {
                console.log('ğŸ“ ë¹ˆ í–‰ ì¶”ê°€ ì‹œì‘');
                
                // í•œ ë²ˆ ë” í™•ì¸ (ë‹¤ë¥¸ ê³³ì—ì„œ ì¶”ê°€ë˜ì—ˆì„ ìˆ˜ ìˆìŒ)
                const doubleCheckCount = tableBodyAuto.querySelectorAll('tr').length;
                if (doubleCheckCount > 0) {
                  console.log('âœ… ë‹¤ë¥¸ ê³³ì—ì„œ ì´ë¯¸ í–‰ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤:', doubleCheckCount, 'í–‰');
                  window.autoSheetRowsAdding = false;
                  return;
                }
                
                // addRowAuto í•¨ìˆ˜ë¥¼ ì§ì ‘ ì‚¬ìš© (prompt ì—†ì´)
                if (typeof window.addRowAuto === 'function') {
                  // ìµœì†Œ 30ê°œ í–‰ ì¶”ê°€ (ë§¤ë²ˆ í–‰ ìˆ˜ í™•ì¸í•˜ì—¬ ì¤‘ë³µ ë°©ì§€)
                  let addedCount = 0;
                  const targetCount = 30;
                  
                  for (let i = 1; i <= targetCount; i++) {
                    // ë§¤ë²ˆ í˜„ì¬ í–‰ ìˆ˜ í™•ì¸
                    const currentCount = tableBodyAuto.querySelectorAll('tr').length;
                    if (currentCount >= targetCount) {
                      console.log('âœ… ì´ë¯¸', targetCount, 'ê°œ í–‰ì´ ìˆìŠµë‹ˆë‹¤. ì¶”ê°€ ì¤‘ë‹¨ (í˜„ì¬:', currentCount, 'í–‰)');
                      break;
                    }
                    
                    // í–‰ ì¶”ê°€
                    window.addRowAuto(i);
                    addedCount++;
                    
                    // ì¶”ê°€ í›„ ë‹¤ì‹œ í™•ì¸ (ë¹„ë™ê¸°ë¡œ ì¶”ê°€ë˜ì—ˆì„ ìˆ˜ ìˆìŒ)
                    const afterAddCount = tableBodyAuto.querySelectorAll('tr').length;
                    if (afterAddCount >= targetCount) {
                      console.log('âœ… í–‰ ì¶”ê°€ ì™„ë£Œ (í˜„ì¬:', afterAddCount, 'í–‰)');
                      break;
                    }
                  }
                  console.log('âœ…', addedCount, 'ê°œ í–‰ ì¶”ê°€ ì™„ë£Œ (ìµœì¢… í–‰ ìˆ˜:', tableBodyAuto.querySelectorAll('tr').length, ')');
                } else if (typeof window.addRow === 'function') {
                  // addRow í•¨ìˆ˜ê°€ í™œì„± ì‹œíŠ¸ë¥¼ í™•ì¸í•˜ë¯€ë¡œ mainAutoSheetê°€ active ìƒíƒœì—ì„œ í˜¸ì¶œ
                  // ìµœì†Œ 30ê°œ í–‰ ì¶”ê°€ (ë§¤ë²ˆ í–‰ ìˆ˜ í™•ì¸í•˜ì—¬ ì¤‘ë³µ ë°©ì§€)
                  let addedCount = 0;
                  const targetCount = 30;
                  
                  for (let i = 1; i <= targetCount; i++) {
                    // ë§¤ë²ˆ í˜„ì¬ í–‰ ìˆ˜ í™•ì¸
                    const currentCount = tableBodyAuto.querySelectorAll('tr').length;
                    if (currentCount >= targetCount) {
                      console.log('âœ… ì´ë¯¸', targetCount, 'ê°œ í–‰ì´ ìˆìŠµë‹ˆë‹¤. ì¶”ê°€ ì¤‘ë‹¨ (í˜„ì¬:', currentCount, 'í–‰)');
                      break;
                    }
                    
                    // í–‰ ì¶”ê°€
                    window.addRow(i);
                    addedCount++;
                    
                    // ì¶”ê°€ í›„ ë‹¤ì‹œ í™•ì¸
                    const afterAddCount = tableBodyAuto.querySelectorAll('tr').length;
                    if (afterAddCount >= targetCount) {
                      console.log('âœ… í–‰ ì¶”ê°€ ì™„ë£Œ (í˜„ì¬:', afterAddCount, 'í–‰)');
                      break;
                    }
                  }
                  console.log('âœ…', addedCount, 'ê°œ í–‰ ì¶”ê°€ ì™„ë£Œ (addRow ì‚¬ìš©, ìµœì¢… í–‰ ìˆ˜:', tableBodyAuto.querySelectorAll('tr').length, ')');
                } else {
                  console.warn('âš ï¸ addRow í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
              } else {
                console.log('âœ… ì´ë¯¸ í–‰ì´ ìˆìŠµë‹ˆë‹¤:', finalRowCount, 'í–‰');
              }
              
              // í”Œë˜ê·¸ í•´ì œ
              window.autoSheetRowsAdding = false;
            }, 500);
          } else if (rowCount > 0) {
            console.log('âœ… ì´ë¯¸ í–‰ì´ ìˆìŠµë‹ˆë‹¤:', rowCount, 'í–‰');
          } else {
            console.log('âš ï¸ í–‰ ì¶”ê°€ê°€ ì´ë¯¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.');
          }
        }
        
        // íƒ­ í™œì„±í™”
        const tab = document.querySelector('.sheet-tab[data-sheet="mainAuto"]');
        if (tab) {
          tab.classList.add('active');
        }
        
        // ì¶•êµ¬(ìë™) ì‹œíŠ¸ê°€ ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤ ì¡°ì • (ì—¬ëŸ¬ ë²ˆ ì‹œë„)
        setTimeout(() => {
          if (mainAutoSheet) {
            console.log('ğŸ”„ ìŠ¤í¬ë¡¤ ì¡°ì • ì‹œì‘');
            // ë¨¼ì € ì‹œíŠ¸ ìì²´ë¥¼ ë³´ì´ë„ë¡
            mainAutoSheet.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // ì¶”ê°€ë¡œ ì‹œíŠ¸ ë‚´ë¶€ì˜ í…Œì´ë¸”ì´ ë³´ì´ë„ë¡ ì¡°ì •
            const inputTableAuto = document.getElementById('inputTableAuto');
            if (inputTableAuto) {
              console.log('âœ… inputTableAuto ì°¾ìŒ');
              inputTableAuto.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
              console.warn('âš ï¸ inputTableAutoë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
            
            // í•œ ë²ˆ ë” í™•ì¸í•˜ì—¬ í™•ì‹¤íˆ ë³´ì´ë„ë¡
            setTimeout(() => {
              mainAutoSheet.style.setProperty('display', 'block', 'important');
              mainAutoSheet.style.setProperty('visibility', 'visible', 'important');
              mainAutoSheet.style.setProperty('opacity', '1', 'important');
              
              if (inputTableAuto) {
                const rect = inputTableAuto.getBoundingClientRect();
                const computedStyle = window.getComputedStyle(inputTableAuto);
                console.log('ğŸ“Š inputTableAuto ìœ„ì¹˜:', rect);
                console.log('ğŸ“Š inputTableAuto computed style:', {
                  display: computedStyle.display,
                  visibility: computedStyle.visibility,
                  opacity: computedStyle.opacity,
                  width: computedStyle.width,
                  height: computedStyle.height,
                  position: computedStyle.position,
                  zIndex: computedStyle.zIndex
                });
                
                // ë¶€ëª¨ ìš”ì†Œë“¤ë„ í™•ì¸
                let parent = inputTableAuto.parentElement;
                let parentLevel = 0;
                while (parent && parentLevel < 5) {
                  const parentStyle = window.getComputedStyle(parent);
                  if (parentStyle.display === 'none' || parentStyle.visibility === 'hidden' || parseFloat(parentStyle.opacity) === 0) {
                    console.warn(`âš ï¸ ë¶€ëª¨ ìš”ì†Œ (${parentLevel}ë‹¨ê³„) ë¬¸ì œ ë°œê²¬:`, {
                      element: parent.tagName,
                      id: parent.id,
                      class: parent.className,
                      display: parentStyle.display,
                      visibility: parentStyle.visibility,
                      opacity: parentStyle.opacity
                    });
                  }
                  parent = parent.parentElement;
                  parentLevel++;
                }
                
                if (rect.top < 0 || rect.bottom > window.innerHeight || rect.width === 0 || rect.height === 0) {
                  console.log('ğŸ”„ inputTableAutoê°€ í™”ë©´ ë°–ì´ê±°ë‚˜ í¬ê¸°ê°€ 0ì…ë‹ˆë‹¤. ìŠ¤í¬ë¡¤ ì¡°ì •');
                  inputTableAuto.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
              }
              
              // ìµœì¢… í™•ì¸ - mainAutoSheetì˜ ëª¨ë“  ìŠ¤íƒ€ì¼ í™•ì¸
              const finalComputedStyle = window.getComputedStyle(mainAutoSheet);
              const finalRect = mainAutoSheet.getBoundingClientRect();
              console.log('âœ… ìµœì¢… mainAutoSheet ìƒíƒœ:', {
                display: finalComputedStyle.display,
                visibility: finalComputedStyle.visibility,
                opacity: finalComputedStyle.opacity,
                position: finalComputedStyle.position,
                zIndex: finalComputedStyle.zIndex,
                width: finalComputedStyle.width,
                height: finalComputedStyle.height,
                rect: finalRect
              });
              
              if (finalComputedStyle.display === 'none') {
                console.error('âŒ ì—¬ì „íˆ displayê°€ noneì…ë‹ˆë‹¤! ê°•ì œ ì¬ì„¤ì •');
                mainAutoSheet.style.setProperty('display', 'block', 'important');
              }
              
              if (finalRect.width === 0 || finalRect.height === 0) {
                console.warn('âš ï¸ mainAutoSheetì˜ í¬ê¸°ê°€ 0ì…ë‹ˆë‹¤!');
              }
              
              if (finalRect.top < -1000 || finalRect.bottom > window.innerHeight + 1000) {
                console.warn('âš ï¸ mainAutoSheetê°€ í™”ë©´ ë°–ì— ìˆìŠµë‹ˆë‹¤!');
                mainAutoSheet.scrollIntoView({ behavior: 'smooth', block: 'start' });
              }
            }, 200);
          }
        }, 50);
      } else if (sheetName === 'sheet1') {
        console.log('âœ… ê¸ˆì§€ íƒ­ í‘œì‹œ');
        const sheet1 = document.getElementById('sheet1');
        if (!sheet1) {
          console.error('âŒ sheet1ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
          return;
        }
        
        // mainSheetì™€ mainAutoSheetë¥¼ í™•ì‹¤íˆ ìˆ¨ê¸°ê¸°
        if (mainSheet) {
          mainSheet.style.setProperty('display', 'none', 'important');
          mainSheet.style.setProperty('visibility', 'hidden', 'important');
          mainSheet.classList.remove('active');
        }
        if (mainAutoSheet) {
          mainAutoSheet.style.setProperty('display', 'none', 'important');
          mainAutoSheet.style.setProperty('visibility', 'hidden', 'important');
          mainAutoSheet.classList.remove('active');
        }
        
        // sheet1 ê°•ì œë¡œ í‘œì‹œ
        sheet1.style.setProperty('display', 'block', 'important');
        sheet1.style.setProperty('visibility', 'visible', 'important');
        sheet1.style.setProperty('opacity', '1', 'important');
        sheet1.style.setProperty('position', 'relative', 'important');
        sheet1.style.setProperty('z-index', '1', 'important');
        sheet1.classList.add('active');
        
        const sheet1Tab = document.querySelector('.sheet-tab[data-sheet="sheet1"]');
        if (sheet1Tab) {
          sheet1Tab.classList.add('active');
        }
        
        // ê¸ˆì§€ íƒ­ìœ¼ë¡œ ì „í™˜í•  ë•Œ í•­ìƒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸°
        console.log('ğŸ”„ ê¸ˆì§€ íƒ­ìœ¼ë¡œ ì „í™˜ - ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘');
        
        // ê¸ˆì§€ íƒ­ì´ í‘œì‹œëœ í›„ì— ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° (ì•½ê°„ì˜ ì§€ì—°)
        setTimeout(async () => {
          const tbody = document.getElementById('sheet1_tbody');
          if (!tbody) {
            console.error('âŒ sheet1_tbodyë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }
          
          // ìºì‹œëœ ë°ì´í„° í™•ì¸ (ë°ì´í„°ê°€ ìˆì„ ë•Œë§Œ í‘œì‹œ)
          if (cachedSheet1Data && Array.isArray(cachedSheet1Data) && cachedSheet1Data.length > 0) {
            console.log('ğŸ“‹ ìºì‹œëœ ë°ì´í„° ìˆìŒ:', cachedSheet1Data.length, 'ê°œ - ì¦‰ì‹œ í‘œì‹œ');
            renderSheet1Data(cachedSheet1Data, tbody);
          } else {
            // ìºì‹œëœ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ ìƒíƒœë¡œ ìœ ì§€í•˜ê³  Firebaseì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
            console.log('ğŸ“‹ ìºì‹œëœ ë°ì´í„° ì—†ìŒ - ë¹ˆ ìƒíƒœë¡œ ìœ ì§€í•˜ê³  Firebaseì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°');
            tbody.innerHTML = '';
            
            // window.loadSheet1Dataê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
            let waitCount = 0;
            const maxWait = 20; // 4ì´ˆ (200ms * 20)
            
            const waitForFirebase = setInterval(async () => {
              waitCount++;
              
              if (typeof window.loadSheet1Data === 'function') {
                console.log('âœ… window.loadSheet1Data ë¡œë“œ ì™„ë£Œ - ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘');
                clearInterval(waitForFirebase);
                
                try {
                  const sheet1Data = await window.loadSheet1Data();
                  console.log('âœ… Firebaseì—ì„œ ê¸ˆì§€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ:', sheet1Data ? sheet1Data.length : 0, 'ê°œ í•­ëª©');
                  
                  if (sheet1Data && sheet1Data.length > 0) {
                    // ë°ì´í„°ë¥¼ ìºì‹œì— ì €ì¥
                    cachedSheet1Data = sheet1Data;
                    // í…Œì´ë¸”ì— ë°ì´í„° í‘œì‹œ
                    renderSheet1Data(sheet1Data, tbody);
                    console.log('âœ… ê¸ˆì§€ íƒ­ ë°ì´í„° í‘œì‹œ ì™„ë£Œ');
                  } else {
                    console.log('â„¹ï¸ Firebaseì— ì €ì¥ëœ ê¸ˆì§€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ ìƒíƒœë¡œ ìœ ì§€í•©ë‹ˆë‹¤.');
                    // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ ìƒíƒœë¡œ ìœ ì§€ (ê¸°ë³¸ í–‰ ì¶”ê°€í•˜ì§€ ì•ŠìŒ)
                    const tbody = document.getElementById('sheet1_tbody');
                    if (tbody) {
                      tbody.innerHTML = '';
                    }
                  }
                } catch (error) {
                  console.error('âŒ Firebaseì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
                }
              } else if (waitCount >= maxWait) {
                console.warn('âš ï¸ window.loadSheet1Data ë¡œë“œ ì‹œê°„ ì´ˆê³¼');
                clearInterval(waitForFirebase);
              }
            }, 200);
          }
          
          // ìºì‹œëœ ë°ì´í„°ê°€ ìˆì–´ë„ Firebaseì—ì„œ ìµœì‹  ë°ì´í„° í™•ì¸
          loadSheet1Data().catch(err => {
            console.error('âŒ loadSheet1Data ì‹¤íŒ¨:', err);
          });
        }, 200);
        
        // ê¸ˆì§€ ì‹œíŠ¸ê°€ ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤ ì¡°ì •
        setTimeout(() => {
          if (sheet1) {
            sheet1.scrollIntoView({ behavior: 'smooth', block: 'start' });
            // í•œ ë²ˆ ë” í™•ì¸í•˜ì—¬ í™•ì‹¤íˆ ë³´ì´ë„ë¡
            setTimeout(() => {
              sheet1.style.setProperty('display', 'block', 'important');
              sheet1.style.setProperty('visibility', 'visible', 'important');
              sheet1.style.setProperty('opacity', '1', 'important');
              
              // ìµœì¢… í™•ì¸
              const finalComputedStyle = window.getComputedStyle(sheet1);
              const finalRect = sheet1.getBoundingClientRect();
              console.log('âœ… ìµœì¢… sheet1 ìƒíƒœ:', {
                display: finalComputedStyle.display,
                visibility: finalComputedStyle.visibility,
                opacity: finalComputedStyle.opacity,
                rect: finalRect
              });
              
              if (finalComputedStyle.display === 'none') {
                console.error('âŒ ì—¬ì „íˆ displayê°€ noneì…ë‹ˆë‹¤! ê°•ì œ ì¬ì„¤ì •');
                sheet1.style.setProperty('display', 'block', 'important');
              }
            }, 200);
          }
        }, 100);
      }
    }
    
    // ì‹œíŠ¸1 í–‰ ì¶”ê°€ í•¨ìˆ˜
    function addSheet1Row() {
      const tbody = document.getElementById('sheet1_tbody');
      if (!tbody) return;
      
      const rowCount = tbody.querySelectorAll('tr').length;
      const tr = document.createElement('tr');
      
      tr.innerHTML = `
        <td>${rowCount + 1}</td>
        <td><input type="text" style="width: 100%; border: none; padding: 5px;"></td>
        <td><input type="text" style="width: 100%; border: none; padding: 5px;"></td>
        <td><input type="text" style="width: 100%; border: none; padding: 5px;"></td>
        <td><input type="text" style="width: 100%; border: none; padding: 5px;"></td>
        <td><input type="text" style="width: 100%; border: none; padding: 5px;"></td>
        <td>
          <button class="btn btn-small" onclick="deleteSheet1Row(this)">ì‚­ì œ</button>
        </td>
      `;
      
      tbody.appendChild(tr);
    }
    
    // ì‹œíŠ¸1 í–‰ ì‚­ì œ í•¨ìˆ˜
    function deleteSheet1Row(btn) {
      if (confirm('ì‚­ì œí•˜ê² ìŠµë‹ˆê¹Œ?')) {
        btn.closest('tr').remove();
        // ë²ˆí˜¸ ì¬ì •ë ¬
        const tbody = document.getElementById('sheet1_tbody');
        tbody.querySelectorAll('tr').forEach((row, index) => {
          row.cells[0].textContent = index + 1;
        });
      }
    }
    
    // ì‹œíŠ¸1 ë°ì´í„° ì €ì¥ í•¨ìˆ˜
    async function saveSheet1() {
      const tbody = document.getElementById('sheet1_tbody');
      if (!tbody) return;
      
      const rows = tbody.querySelectorAll('tr');
      const sheet1Data = [];
      
      rows.forEach((row) => {
        const cells = row.querySelectorAll('td');
        if (cells.length >= 6) {
          const inputs = row.querySelectorAll('input');
          if (inputs.length >= 5) {
            sheet1Data.push({
              time: inputs[0].value || '',
              league: inputs[1].value || '',
              home: inputs[2].value || '',
              away: inputs[3].value || '',
              content: inputs[4].value || ''
            });
          }
        }
      });
      
      try {
        // window.saveSheet1Dataë¥¼ ì‚¬ìš© (ì „ì—­ í•¨ìˆ˜ë¡œ ì´ë¯¸ ë“±ë¡ë¨)
        if (typeof window.saveSheet1Data === 'function') {
          const result = await window.saveSheet1Data(sheet1Data);
          if (result && result.success) {
            alert(`ê¸ˆì§€ ë°ì´í„°ê°€ Firebaseì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (${result.count}ê°œ í•­ëª©)`);
            console.log('âœ… Firebase ì €ì¥ ì„±ê³µ:', result.count, 'ê°œ í•­ëª©');
          } else {
            alert('ê¸ˆì§€ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
          }
        } else {
          // window.saveSheet1Dataê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš° ëŒ€ê¸° í›„ ì¬ì‹œë„
          console.warn('âš ï¸ window.saveSheet1Dataê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ëŒ€ê¸° ì¤‘...');
          await new Promise(resolve => setTimeout(resolve, 1000));
          
          if (typeof window.saveSheet1Data === 'function') {
            const result = await window.saveSheet1Data(sheet1Data);
            if (result && result.success) {
              alert(`ê¸ˆì§€ ë°ì´í„°ê°€ Firebaseì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (${result.count}ê°œ í•­ëª©)`);
            } else {
              alert('ê¸ˆì§€ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          } else {
            // import ì‚¬ìš© (í´ë°±)
            const { saveSheet1Data } = await import('../app.js');
            const result = await saveSheet1Data(sheet1Data);
            if (result && result.success) {
              alert(`ê¸ˆì§€ ë°ì´í„°ê°€ Firebaseì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (${result.count}ê°œ í•­ëª©)`);
            } else {
              alert('ê¸ˆì§€ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          }
        }
      } catch (error) {
        console.error('âŒ ê¸ˆì§€ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
        console.error('ì—ëŸ¬ ìƒì„¸:', error.message, error.code);
        alert(`ê¸ˆì§€ ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì˜¤ë¥˜: ${error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
      }
    }
    
    // ì‹œíŠ¸1 ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
    async function loadSheet1Data() {
      console.log('ğŸ”„ loadSheet1Data í•¨ìˆ˜ í˜¸ì¶œë¨');
      
      // sheet1_tbodyë¥¼ ì°¾ê¸° (íƒ­ì´ ìˆ¨ê²¨ì ¸ ìˆì–´ë„ DOMì— ì¡´ì¬í•¨)
      let tbody = document.getElementById('sheet1_tbody');
      
      // tbodyê°€ ì—†ìœ¼ë©´ ì ì‹œ ëŒ€ê¸° í›„ ì¬ì‹œë„ (DOMì´ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŒ)
      if (!tbody) {
        console.warn('âš ï¸ sheet1_tbodyë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. DOM ë¡œë“œ ëŒ€ê¸° ì¤‘...');
        await new Promise(resolve => setTimeout(resolve, 500));
        tbody = document.getElementById('sheet1_tbody');
        if (!tbody) {
          console.error('âŒ sheet1_tbodyë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. DOMì— ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
          console.log('ğŸ” í˜„ì¬ DOM ìƒíƒœ:', document.getElementById('sheet1'));
          return;
        }
      }
      
      console.log('âœ… sheet1_tbody ì°¾ìŒ');
      
      try {
        console.log('ğŸ”„ Firebaseì—ì„œ ê¸ˆì§€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘...');
        console.log('ğŸ” window.loadSheet1Data íƒ€ì…:', typeof window.loadSheet1Data);
        
        // window.loadSheet1Dataë¥¼ ì‚¬ìš© (ì „ì—­ í•¨ìˆ˜ë¡œ ì´ë¯¸ ë“±ë¡ë¨)
        if (typeof window.loadSheet1Data === 'function') {
          console.log('âœ… window.loadSheet1Data í•¨ìˆ˜ ì‚¬ìš©');
          const sheet1Data = await window.loadSheet1Data();
          console.log('âœ… Firebaseì—ì„œ ê¸ˆì§€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ:', sheet1Data ? sheet1Data.length : 0, 'ê°œ í•­ëª©');
          console.log('ğŸ“‹ ë¶ˆëŸ¬ì˜¨ ë°ì´í„°:', sheet1Data);
          
          // ë°ì´í„°ë¥¼ ìºì‹œì— ì €ì¥
          cachedSheet1Data = sheet1Data;
          
          // í…Œì´ë¸”ì— ë°ì´í„° í‘œì‹œ
          console.log('ğŸ”„ í…Œì´ë¸”ì— ë°ì´í„° ë Œë”ë§ ì‹œì‘...');
          renderSheet1Data(sheet1Data, tbody);
          console.log('âœ… ë°ì´í„° ë Œë”ë§ ì™„ë£Œ');
        } else {
          // window.loadSheet1Dataê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš° ëŒ€ê¸° í›„ ì¬ì‹œë„
          console.warn('âš ï¸ window.loadSheet1Dataê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ëŒ€ê¸° ì¤‘...');
          await new Promise(resolve => setTimeout(resolve, 1000));
          
          if (typeof window.loadSheet1Data === 'function') {
            const sheet1Data = await window.loadSheet1Data();
            console.log('âœ… Firebaseì—ì„œ ê¸ˆì§€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ (ì¬ì‹œë„):', sheet1Data ? sheet1Data.length : 0, 'ê°œ í•­ëª©');
            
            // ë°ì´í„°ë¥¼ ìºì‹œì— ì €ì¥
            cachedSheet1Data = sheet1Data;
            
            renderSheet1Data(sheet1Data, tbody);
          } else {
            // import ì‚¬ìš© (í´ë°±)
            console.warn('âš ï¸ window.loadSheet1Dataë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. importë¡œ ì‹œë„í•©ë‹ˆë‹¤...');
            const { loadSheet1Data } = await import('../app.js');
            const sheet1Data = await loadSheet1Data();
            console.log('âœ… Firebaseì—ì„œ ê¸ˆì§€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ (import):', sheet1Data ? sheet1Data.length : 0, 'ê°œ í•­ëª©');
            
            // ë°ì´í„°ë¥¼ ìºì‹œì— ì €ì¥
            cachedSheet1Data = sheet1Data;
            
            renderSheet1Data(sheet1Data, tbody);
          }
        }
      } catch (error) {
        console.error('âŒ ê¸ˆì§€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
        console.error('ì—ëŸ¬ ìƒì„¸:', error.message, error.code);
      }
    }
    
    // ê¸ˆì§€ íƒ­ ë°ì´í„°ë¥¼ í…Œì´ë¸”ì— ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
    function renderSheet1Data(sheet1Data, tbody) {
      if (!tbody) {
        tbody = document.getElementById('sheet1_tbody');
        if (!tbody) {
          console.error('âŒ sheet1_tbodyë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
      }
      
      // ê¸°ì¡´ í–‰ ëª¨ë‘ ì œê±°
      tbody.innerHTML = '';
      
      // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ ìƒíƒœë¡œ ìœ ì§€ (ê¸°ë³¸ í–‰ ì¶”ê°€í•˜ì§€ ì•ŠìŒ)
      if (!sheet1Data || sheet1Data.length === 0) {
        console.log('â„¹ï¸ ì €ì¥ëœ ê¸ˆì§€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ ìƒíƒœë¡œ ìœ ì§€í•©ë‹ˆë‹¤.');
        return;
      }
      
      sheet1Data.forEach((item, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td><input type="text" style="width: 100%; border: none; padding: 5px;" value="${(item.time || '').replace(/"/g, '&quot;')}"></td>
          <td><input type="text" style="width: 100%; border: none; padding: 5px;" value="${(item.league || '').replace(/"/g, '&quot;')}"></td>
          <td><input type="text" style="width: 100%; border: none; padding: 5px;" value="${(item.home || '').replace(/"/g, '&quot;')}"></td>
          <td><input type="text" style="width: 100%; border: none; padding: 5px;" value="${(item.away || '').replace(/"/g, '&quot;')}"></td>
          <td><input type="text" style="width: 100%; border: none; padding: 5px;" value="${(item.content || '').replace(/"/g, '&quot;')}"></td>
          <td>
            <button class="btn btn-small" onclick="deleteSheet1Row(this)">ì‚­ì œ</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      console.log('âœ… ê¸ˆì§€ íƒ­ ë°ì´í„° í‘œì‹œ ì™„ë£Œ');
    }
    
    // ì¡°íšŒ í˜ì´ì§€ë¡œ ì´ë™ (ë¡œê·¸ì¸ ìš°íšŒ)
    function handleViewClick(event) {
      try {
        if (event) {
          event.preventDefault();
          event.stopPropagation();
        }
        
        // ì…ë ¥ í˜ì´ì§€ì—ì„œ ì¡°íšŒ í˜ì´ì§€ë¡œ ì´ë™ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ ì„¤ì •
        sessionStorage.setItem('isLoggedIn', 'true');
        
        // í˜„ì¬ URLì—ì„œ í”„ë¡œí† ì½œ, í˜¸ìŠ¤íŠ¸, í¬íŠ¸ ì¶”ì¶œ
        const urlObj = new URL(window.location.href);
        
        // ë£¨íŠ¸ ê²½ë¡œì˜ view.htmlë¡œ ì´ë™ (ì ˆëŒ€ ê²½ë¡œ)
        const viewUrl = `${urlObj.origin}/view.html`;
        
        console.log('í˜„ì¬ URL:', window.location.href);
        console.log('Origin:', urlObj.origin);
        console.log('ì´ë™í•  URL:', viewUrl);
        
        // ì¦‰ì‹œ ì´ë™
        window.location.href = viewUrl;
        
        return false;
      } catch (error) {
        console.error('handleViewClick ì˜¤ë¥˜:', error);
        // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ì ˆëŒ€ ê²½ë¡œë¡œ ì‹œë„
        const origin = window.location.origin || window.location.protocol + '//' + window.location.host;
        window.location.href = origin + '/view.html';
        return false;
      }
    }
    
    // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
    window.handleViewClick = handleViewClick;
    
  </script>
</body>
</html>
